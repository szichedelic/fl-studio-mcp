# Milestone v2.1: Song Building & Mixing

**Status:** âœ… SHIPPED 2026-02-25
**Phases:** 8-11
**Total Plans:** 9

## Overview

v2.1 delivers song construction capabilities: mixer control for balancing and routing, playlist track organization, marker-based navigation, and project-level controls (including tempo setting). The milestone prioritizes mixer features (highest value, lowest risk) before moving to playlist management and project settings.

## Phases

### Phase 8: Mixer Core

**Goal**: Users can mix tracks with volume, pan, and mute/solo controls
**Depends on**: Phase 7 (v2.0 complete)
**Requirements**: MIX-01, MIX-02, MIX-03, MIX-04, MIX-05, MIX-06
**Plans**: 2 plans

Plans:
- [x] 08-01-PLAN.md - Python handlers: extend state.mixer with color, create mixer.py mutations
- [x] 08-02-PLAN.md - TypeScript tools: MCP tools for volume, pan, mute, solo, name, color

**Success Criteria:**
1. User can read any mixer track's volume, pan, mute, and solo state
2. User can set mixer track volume with natural language ("set drums to -6dB", "make bass louder")
3. User can pan tracks left/right ("pan guitar hard left", "center the vocals")
4. User can mute and solo tracks individually or in groups
5. User can rename and color-code mixer tracks for organization

### Phase 9: Mixer Routing & Advanced

**Goal**: Users can create send busses, parallel processing, and control per-track EQ
**Depends on**: Phase 8
**Requirements**: MIX-07, MIX-08, MIX-09, MIX-10, MIX-11
**Plans**: 2 plans

Plans:
- [x] 09-01-PLAN.md - Python handlers: routing (get/set routes, send levels) and EQ (get/set bands)
- [x] 09-02-PLAN.md - TypeScript tools: routing, EQ, and effect slot convenience wrappers

**Success Criteria:**
1. User can view which tracks route to which destinations
2. User can create sends from any track to any bus ("send drums to reverb bus")
3. User can set send levels per route ("50% send to delay bus")
4. User can adjust built-in EQ bands per track ("boost highs on snare")
5. User can access plugins in mixer effect slots via existing plugin control system

### Phase 10: Playlist & Markers

**Goal**: Users can organize playlist tracks and navigate via markers
**Depends on**: Phase 8
**Requirements**: PLAY-01, PLAY-02, PLAY-03, PLAY-04, PLAY-05, PLAY-06, PLAY-07, PLAY-08
**Plans**: 3 plans

Plans:
- [x] 10-01-PLAN.md - Playlist track management (get info, mute, solo, name, color)
- [x] 10-02-PLAN.md - Markers (add, list, navigate)
- [x] 10-03-PLAN.md - Live clip triggering (performance mode)

**Success Criteria:**
1. User can query playlist track count, names, and states
2. User can mute/solo playlist tracks ("mute verse 2 tracks")
3. User can rename and color playlist tracks for organization
4. User can add markers at specific times ("marker at bar 32 called Chorus")
5. User can navigate to markers by name ("jump to Bridge")
6. User can list all markers in the project
7. User can trigger live clips in performance mode

### Phase 11: Project Controls

**Goal**: Users can control project-level settings like tempo and playback position
**Depends on**: Phase 8
**Requirements**: PROJ-01, PROJ-02, PROJ-03, PROJ-04, PROJ-05, PROJ-06
**Plans**: 2 plans

Plans:
- [x] 11-01-PLAN.md - Tempo and position (get/set tempo, get/set position)
- [x] 11-02-PLAN.md - Undo/redo operations

**Success Criteria:**
1. User can read current tempo
2. User can set tempo ("set tempo to 128 BPM") via processRECEvent
3. User can read current playback position in bars/beats
4. User can jump to specific positions ("go to bar 16")
5. User can undo/redo operations

---

## Milestone Summary

**Key Decisions:**
- Mixer is 0-indexed (0=Master, 1+=inserts), playlist is 1-indexed
- Volume 0.8 = unity gain (0dB), not 1.0
- Color format is BGR (0x--BBGGRR) internally, RGB hex in MCP tools
- Tempo settable via `general.processRECEvent(midi.REC_Tempo, bpm*1000, flags)`
- Use explicit 1/0 for mute/solo, NOT -1 (toggle mode is stateless/unpredictable)
- Position setSongPos: only modes -1, 0, 1, 2 work for writing (3-5 are read-only)
- Undo/Redo: use undoUp()/undoDown(), NOT undo() (undo toggles unpredictably)
- NO API for playlist clip placement - track management only

**Issues Resolved:**
- Parameter naming mismatch in routing tools (fixed in 4c35926)
- Marker enumeration without markerCount API (iterate until empty string)

**Technical Debt:**
- Marker navigation uses relative jumpToMarker API (may not work perfectly for absolute jumps)
- Time signature assumed to be 4/4 for bar-to-tick calculations

---

*For current project status, see .planning/ROADMAP.md*
